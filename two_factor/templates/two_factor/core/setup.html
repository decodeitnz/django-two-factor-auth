{% extends "two_factor/_base_focus.html" %}
{% load i18n %}
{% load static %}

{% block extra_media %}
  {{ form.media }}
{% endblock %}

{% block content %}
  <h1>{% block title %}{% trans "Enable Two-Factor Authentication" %}{% endblock %}</h1>

  <div class="gray">
  {% if wizard.steps.current == 'welcome' %}
    <p>{% blocktrans trimmed %}You are about to take your account security to the
        next level. Follow the steps in this wizard to enable two-factor
        authentication.{% endblocktrans %}</p>
  {% elif wizard.steps.current == 'method' %}
    <p>{% blocktrans trimmed %}Please select which authentication method you would
        like to use.{% endblocktrans %}</p>
  {% elif wizard.steps.current == 'generator' %}
    <p>{% blocktrans trimmed %}To start using an Authenticator app, please use your
        smartphone to scan the QR code below. For example, use Google
      Authenticator.{% endblocktrans %}</p>
    <ol>
      <li><p>{% blocktrans trimmed %}If you already have a preferred Authenticator App
          on your mobile (e.g., Microsoft Authenticator or Google Authenticator), open
          the app. If not, we recommend that you install Microsoft Authenticator.
          You can search for it in the app marketplace, or scan the following code.
          (This is a free app.){% endblocktrans %}</p>
        <div class="ms-3 mb-3"><img src="{% static 'images/microsoft-authenticator-qrcode-smaller.png' %}" alt="QR Code" class="bg-white"/>
            Scan to install Microsoft Authenticator</div>
      </li>
      <li><p><b>Add Account to Authenticator App</b>: {% blocktrans trimmed %}In your authenticator app, <i>Add Account</i> >
          <i>Other Account</i> > <i>Scan QR Code</i>, then scan the following
          code:{% endblocktrans %}</p>
        <div class="ms-3 mb-3"><img src="{{ QR_URL }}" alt="QR Code" class="bg-white"/>
          Scan to add Account to your Authenticator app</div>
        <p>{% blocktrans trimmed %}Alternatively you can use the following secret to
          setup TOTP in your authenticator or password manager manually.{% endblocktrans %}</p>
        <p>{% translate "TOTP Secret:" %} <a href="{{ otpauth_url }}">{{ secret_key }}</a></p>
      </li>
      <li><b>Enter Code from app</b>: {% blocktrans %}Enter the code generated by the app to complete the setup.{% endblocktrans %}</p>
      </li>
    </ol>
  {% elif wizard.steps.current == 'sms' %}
    <p>{% blocktrans trimmed %}Please enter the phone number you wish to receive the
      text messages on. This number will be validated in the next step.
      {% endblocktrans %}</p>
  {% elif wizard.steps.current == 'call' %}
    <p>{% blocktrans trimmed %}Please enter the phone number you wish to be called on.
      This number will be validated in the next step. {% endblocktrans %}</p>
  {% elif wizard.steps.current == 'validation' %}
    {% if challenge_succeeded %}
      {% if device.method == 'call' %}
        <p>{% blocktrans trimmed %}We are calling your phone right now, please enter the
          digits you hear.{% endblocktrans %}</p>
      {% elif device.method == 'sms' %}
        <p>{% blocktrans trimmed %}We sent you a text message, please enter the codes we
          sent.{% endblocktrans %}</p>
      {% else %}
          {# Fixme: this just presumes email, since for some reason device.method is empty #}
          An email has been sent to you with a code. Please enter it here.
      {% endif %}
    {% else %}
      <p class="alert alert-warning" role="alert">{% blocktrans trimmed %}We've
        encountered an issue with the selected authentication method. Please
        go back and verify that you entered your information correctly, try
        again, or use a different authentication method instead. If the issue
        persists, contact the site administrator.{% endblocktrans %}</p>
    {% endif %}
  {% elif wizard.steps.current == 'yubikey' %}
    <p>{% blocktrans trimmed %}To identify and verify your YubiKey, please insert a
      code in the field below. Your YubiKey will be linked to your
      account.{% endblocktrans %}</p>
  {% endif %}

  <div class="ps-4">
      <form action="" method="post" class="two-factor-setup">{% csrf_token %}
        {% include "two_factor/_wizard_forms.html" %}

        {# hidden submit button to enable [enter] key #}
        <input type="submit" value="" hidden />

        <div class="mt-3">
          {% include "two_factor/_wizard_actions.html" %}
        </div>
      </form>
  </div>
  </div>
{% endblock %}
